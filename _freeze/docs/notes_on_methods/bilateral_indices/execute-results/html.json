{
  "hash": "9386276e83efa2960fa60a0b303a7f34",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Notes on bilateral price index methods\"\nsubtitle: Overview with examples of common bilateral methods\nauthor: Serge Goussev\ndate: 2024-09-27\ndate-modified: last-modified\nexecute:\n  echo: true\n  output: true\nformat:\n  html:\n    toc: true\n    toc-expand: 2\n    html-math-method:\n      method: mathjax\n      url: \"https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js\"\n    other-links:\n      - text: Aizcorbe (2014) A Practical Guide to Price Index and Hedonic Techniques\n        href: https://global.oup.com/academic/product/a-practical-guide-to-price-index-and-hedonic-techniques-9780198702429?cc=ca&lang=en&      \n      - text: Balk (2008) Price and Quantity Index Numbers\n        href: https://www.cambridge.org/core/books/price-and-quantity-index-numbers/9A54AF90399685AED460F52821BD6225\n      - text: \"CPI Manual: Concepts and Methods (2020)\"\n        href: https://www.imf.org/-/media/Files/Data/CPI/cpi-manual-concepts-and-methods.ashx\n      - text: \"UN Task Team e-handbook: Bilateral Price Index Methods\"      \n        href: https://unstats.un.org/wiki/display/GWGSD/Bilateral+price+index+methods\n\ncategories:\n  - Bilateral price indices\n---\n\n\n\n\n# Overview\n\n## The concept of price index methods\n\n> A price index provides an aggregate measure of price change for a particular product segment, industry, or overall economy. ... \\[They compare\\] the cost of purchasing a set of goods at different points in time. This \"set of goods\" is often referred to as the \"market basket\" or the \"bundle\" of goods. - Aizcorbe (2014)\n\n## Example datasets\n\nTo illustrate how each index can be calculated, I'll illustrate using some example datasets and some common price index methods.\n\n::: {.callout-note collapse=\"true\"}\n## Setup with `gpindex`\n\n[gpindex](https://marberts.github.io/gpindex/index.html) is a convenient R package for price index calculation. It has a simple play dataset built in that we can use to demonstrate how to construct various price indices.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(gpindex)\n\np1 <- price6$t1\np2 <- price6$t2\nq1 <- quantity6$t1\nq2 <- quantity6$t2\n\nhead(price6)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  t1  t2  t3  t4  t5\n1  1 1.2 1.0 0.8 1.0\n2  1 3.0 1.0 0.5 1.0\n3  1 1.3 1.5 1.6 1.6\n4  1 0.7 0.5 0.3 0.1\n5  1 1.4 1.7 1.9 2.0\n6  1 0.8 0.6 0.4 0.2\n```\n\n\n:::\n\n```{.r .cell-code}\nhead(quantity6)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   t1  t2  t3  t4   t5\n1 1.0 0.8 1.0 1.2  0.9\n2 1.0 0.9 1.1 1.2  1.2\n3 2.0 1.9 1.8 1.9  2.0\n4 1.0 1.3 3.0 6.0 12.0\n5 4.5 4.7 5.0 5.6  6.5\n6 0.5 0.6 0.8 1.3  2.5\n```\n\n\n:::\n:::\n\n\n\n:::\n\n# Main formulas\n\n## Laspeyres index\n\nThe simplest formula (and one that is commonly used) is the Laspeyres index:\n\n$$\nI^{L}_{0,1} = \\frac{\\sum_{n=1}^{N}(p_n^1q_n^0)}{\\sum_{n=1}^{N}(p_n^0q_n^0)}\n$$\n\nWhere $p$ and $q$ denote prices and quantities, and 0 and 1 denote two points in time.\n\nIf $N$ goods are sold in both periods (note that an overlap is needed), we can compare the the cost of purchasing the same goods we bought in period 1 with a certain period in the future.\n\nWe can also write the Laspeyres as the weighted arithmetic average of the price change of the individual products in the index\n\n$$\nI^L_{0,1} = \\sum_{n=1}^{N} (w_n^0\\frac{p_n^1}{p_n^0})\n$$ \n\n<center>\nsuch that\n</center>\n\n$$\nw_m^0 = (p_n^0q_n^0)/\\sum_{n=1}^{N}(p_n^0q_n^0)\n$$\n\ngive the ratio of good $n$ expenditure to total expenditure, or could also be considered the relative importance or share of the product. There are some key nuances with this approach:\n\n-   Products sold in both periods are included in both periods, thus new products are omitted.\n-   We fix the relative importance of the goods for both periods based on period 1 weight, thus we do not reflect changes in composition over time (substitution). This can be convenient as we need weights only for the base period.\n    -   Most price indices are variants of the Laspeyres, such as the Lowe (which compare the prices from the current month with the previous month, but use weights from a year before that).\n\n::: {.callout-note collapse=\"true\"}\n## Example with `gpindex`\n\nThere are two ways that we can use the package to compare the two periods - one using the `laspeyres_index()` function, the other using the `arithmetic_mean()` function.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlaspeyres_index(p2, p1, q1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 1.42\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\narithmetic_mean(p2 / p1, index_weights(\"Laspeyres\")(p1, q1))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 1.42\n```\n\n\n:::\n:::\n\n\n\n:::\n\n## Paashe Index\n\nSimilar to the Lasperyes, however uses a different basket (the one from the pricing period):\n\n$$\nI^P_{0,1} = \n  \\sum_{n=1}^N \n    (\n      p_n^1\n      q_n^1\n    ) / \n  \\sum_{n=1}^N\n    (\n      p_n^0\n      q_n^1\n    )\n$$\n\nThe Paasche may also be expressed as a function of the weighted average (i.e. shares):\n\n$$\nI^P_{0,1} = \n  1/ \n  \\sum_{n=1}^N \n    (\n      w_n^1\n      \\frac\n        {p_n^0}\n        {p_n^1}\n    )\n$$\n\n<center>\nsuch that\n</center>\n\n$$\nw_{n,1} = \n  (\n    p_n^1\n    q_n^1\n  )/ \n  \\sum_{n=1}^n\n  (\n    w_n^1\n    p_n^0\n    q_n^1\n  )\n$$\n\nThe Laspeyres and Paasche include prices and quantities in both periods, and both use the same relatives with different expenditure shares.\n\n::: {.callout-note collapse=\"true\"}\n## Example with `gpindex`\n\nThere are two ways that we can use the package to compare the two periods - one using the `paasche_index()` function, the other using the `arithmetic_mean()` function.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npaasche_index(p2, p1, q2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 1.382353\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\narithmetic_mean(p2 / p1, index_weights(\"Paasche\")(p1, q2))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 1.382353\n```\n\n\n:::\n:::\n\n\n\n:::\n\n\n## Fisher Index\n\nThe Fisher does a geometric average of the Laspeyres and the Paasche:\n\n$$\nI^F_{0,1} = (\n  I^L_{0,1}\n  I^P_{0,1})^\\frac{1}{2}\n$$\n\nThe Fisher thus uses expenditure from both periods and thus provides relative importance that are more closely aligned with the goods actually sold. As the Fisher satisfies homogeneity, symmetry, and the time reversal test (the price change from the base to the current should be the inverse of the current to the base) - thus it doesn't matter what period is chosen as the base.\n\n::: {.callout-note collapse=\"true\"}\n## Example with `gpindex`\n\nThere is an out of the box function we can use - the `fisher_index()` function.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfisher_index(p2, p1, q2, q1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 1.40105\n```\n\n\n:::\n:::\n\n\n\n:::\n\n## Törnqvist Index\n\nSimilar to the Fisher, however it takes the average of the weights instead of averaging the two indices\n\nIn logged form:\n$$\nlnI^T_{0,1}=\n  \\sum^N_{n=1}\n  (\n    w_{n,0}+\n    w_{n,1}\n  )/2\n  (\n    ln\\frac\n      {p_{n,1}}\n      {p_{n,0}}\n  )\n$$\n\nWe can also view the Törnqvist as an exponenet of logged form (quite similar to the above):\n\n$$\nP^T(p^1,q^1,p^0,q^0) = exp\\{\n  \\sum_{n=1}^N\n    \\frac{1}{2}\n      (s_n^1+s_n^1)\n      ln(p_n^1/p_n^0)\n  \\}\n$$\n\nAnd also in more traditional form:\n\n$$\nP^T(p^1,q^1,p^0,q^0) = \n \\prod_{n=1}^N\n \\left(\n \\frac{p_n^1}{p_n^0}\n \\right)\n ^{\\frac{s_n^1+s_n^0}{2}}\n$$\n\n::: {.callout-note collapse=\"true\"}\n## Example with `gpindex`\n\nAs there is no out of the box function for the Törnqvist, we can use the `geometric_mean()` function.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 1. Calculate value shares for both periods\ns1 <- (p1 * q1) / sum(p1 * q1)\ns2 <- (p2 * q2) / sum(p2 * q2)\n\n# 2. Calculate Törnqvist weights (arithmetic average of shares)\nw_tornqvist <- (s1 + s2) / 2\n\n# 3. Compute the index using geometric_mean()\ngeometric_mean(p2/p1, w_tornqvist)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 1.405162\n```\n\n\n:::\n:::\n\n\n\n:::\n\n## Jevons Index\n\nThe Jevons is unweighted geometric mean. Similar to the Törnqvist, in logged form:\n\n$$\nlnI^J_{0,1} = \n  \\frac{1}{N} \n  \\sum^N_{n=1}\n    ln(p_n^1/p_n^0)\n$$\n\nThe Jevons takes the unweighted average by replacing the $(w_{m,0}+w_{m,1})/2$ with $1/M$, thus giving each model equal weight\n\nThe Jevons can also be written in simpler form as per Balk(2008) (formula 1.5).\n\n$$\nP^J(p^1,p^0) = \n \\prod_{n=1}^N\n \\left(\n \\frac{p_n^1}{p_n^0}\n \\right)\n ^{1/N}\n$$\n\n\n::: {.callout-note collapse=\"true\"}\n## Example with `gpindex`\n\nThere are two ways that we can use the package to compare the two periods - one using the `jevons_index()` function, the other using the `geometric_mean()` function.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\njevons_index(p2, p1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 1.24192\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ngeometric_mean(p2 / p1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 1.24192\n```\n\n\n:::\n:::\n\n\n\n:::\n\n\n# Comparison across the larger synthetic dataset\n\nUsing the full toy dataset - lets compare the price indices\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\n# 1. Use t1 as the base period\np_base <- price6$t1\nq_base <- quantity6$t1\n\n# 2. Loop through the periods to calculate indices for the set\nresults <- mapply(function(p_curr, q_curr) {\n  # Calculate current value shares (s1) for Törnqvist weights\n  s1 <- (p_curr * q_curr) / sum(p_curr * q_curr)\n  s2 <- (p_base * q_base) / sum(p_base * q_base)\n  w_torn <- (s1 + s2) / 2\n  \n  c(\n    Laspeyres = laspeyres_index(p_curr, p_base, q_base),\n    Paasche   = paasche_index(p_curr, p_base, q_curr),\n    Fisher    = fisher_index(p_curr, p_base, q_curr, q_base),\n    Tornqvist = geometric_mean(p_curr / p_base, w_torn),\n    Jevons    = geometric_mean(p_curr / p_base)\n  )\n}, price6, quantity6)\n\n# 3. Convert to a clean dataframe\ndf_indexes <- as.data.frame(t(results))\ndf_indexes$Period <- rownames(df_indexes)\n\n## Now lets plot this (for which we need a few additional libraries)\nlibrary(ggplot2)\nlibrary(tidyr)\n\n# 4. Convert from wide to long format\ndf_long <- pivot_longer(df_indexes, \n                        cols = c(\"Laspeyres\", \"Paasche\", \"Jevons\", \"Fisher\", \"Tornqvist\"), \n                        names_to = \"Index_Type\", \n                        values_to = \"Value\")\n\n# 5. Create the plot\nggplot(df_long, aes(x = Period, y = Value, color = Index_Type, group = Index_Type)) +\n  geom_line(linewidth = 1) + \n  geom_point() +\n  theme_minimal() +           \n  labs(title = \"Comparison of Price Indexes (Base = t1)\",\n       subtitle = \"(Uses gpindex play price6 and quantity6 data)\",\n       x = \"Time Period\",\n       y = \"Index Value\",\n       color = \"Method\")\n```\n\n::: {.cell-output-display}\n![](bilateral_indices_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::",
    "supporting": [
      "bilateral_indices_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}